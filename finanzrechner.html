
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JMVEST Finanzcheck â€“ Ãœberarbeitetes UI</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" defer></script>

<style>
  :root{
    /* Brand */
    --brand-700:#0e3c22;
    --brand-600:#134e2d;
    --brand-500:#1b6a40;
    --accent-500:#3b82f6;
    --ink:#0f172a;
    --muted:#475569;
    --outline:#e2e8f0;
    --success:#16a34a;
    --warning:#f59e0b;
    --danger:#ef4444;

    /* Surfaces */
    --bg: radial-gradient(1200px 600px at 10% -10%, #c7f9cc22 0%, transparent 60%),
          radial-gradient(1200px 600px at 110% 10%, #b1e3ff22 0%, transparent 60%),
          linear-gradient(180deg, #f7faf9 0%, #eef3f2 100%);
    --card: rgba(255,255,255,0.9);
    --glass: blur(10px) saturate(120%);
    --shadow-lg: 0 20px 45px rgba(16,24,40,.08);
    --shadow-md: 0 10px 25px rgba(16,24,40,.06);
    --radius-xl: 18px;
    --radius-lg: 14px;
    --radius-md: 12px;
  }

  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0;
    font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    color:var(--ink);
    background:var(--bg);
  }

  /* Header */
  .hero{ position:relative; padding:38px 20px 10px; text-align:center; }
  .brand{ display:flex; align-items:center; justify-content:center; gap:10px; color:var(--brand-600); }
  .brand-logo{
    width:44px; height:44px; border-radius:12px;
    background:linear-gradient(135deg, var(--brand-600), var(--brand-500));
    box-shadow:0 10px 18px rgba(19,78,45,.25), inset 0 0 0 2px rgba(255,255,255,.25);
    display:grid; place-items:center; color:white; font-weight:800;
  }
  h1{ margin:8px 0 6px; font-size: clamp(26px, 2vw + 14px, 34px); letter-spacing: .2px }
  .hero p{ margin:0; color:#64748b }

  /* Tabs */
  .tabs{
    max-width:1260px; margin:16px auto 0; padding:0 20px;
    display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center;
  }
  .tab{
    -webkit-appearance:none; appearance:none;
    border:1px solid var(--outline); background:#fff; color:var(--ink);
    padding:12px 18px; border-radius:999px; font-weight:800; cursor:pointer;
    box-shadow:var(--shadow-md); font-size:1.02rem;
  }
  .tab[aria-selected="true"]{
    background:linear-gradient(135deg, var(--brand-600), var(--brand-500));
    color:#fff; border-color:transparent;
  }
  .tabpanels{ max-width:1260px; margin:12px auto 0; padding:0 20px; }
  .tabpanel{ display:none }
  .tabpanel[aria-hidden="false"]{ display:block }

  /* Layout */
  .wrap{ max-width:1260px; margin:10px auto 40px; padding:0 }
  .grid{ display:grid; grid-template-columns: 1.05fr 1fr; gap:22px }
  @media (max-width: 1020px){ .grid{ grid-template-columns:1fr } }

  /* Cards */
  .card{
    background:var(--card);
    -webkit-backdrop-filter: var(--glass);
    backdrop-filter: var(--glass);
    border:1px solid rgba(226,232,240,.9);
    border-radius:var(--radius-xl);
    box-shadow: var(--shadow-lg);
  }
  .card .pad{ padding:24px }
  .divider{ height:1px; background:var(--outline); margin:14px 0 8px; opacity:.8 }

  /* Form */
  .form-title{
    font-weight:800; font-size:1.15rem; letter-spacing:.2px; color:var(--brand-600);
    display:flex; align-items:center; gap:10px;
  }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
  @media (max-width: 640px){ .row{ grid-template-columns:1fr } }

  label{ display:block; font-weight:700; margin-top:14px; font-size:1.02rem }
  .hint{ font-size:.92rem; color:#64748b; margin-top:6px }
  .field{ margin-top:10px; position:relative; }
  input[type="number"], select, input[type="range"]{
    width:100%; border-radius:14px; padding:16px 16px; border:1.2px solid var(--outline); background:#fff;
    font-size:1.06rem; transition: box-shadow .2s, border-color .2s, transform .02s;
    box-shadow: 0 1px 0 rgba(2,8,23,.02);
  }
  input[type="number"]:focus, select:focus, input[type="range"]:focus{
    outline:none; border-color:var(--accent-500);
    box-shadow: 0 0 0 3px rgba(59,130,246,.18);
  }
  input[type="range"]{ padding:0; height:40px; -webkit-appearance:none; background:transparent }
  input[type="range"]::-webkit-slider-runnable-track{ height:10px; border-radius:12px; background:linear-gradient(90deg,#e2e8f0,#cbd5e1) }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; width:26px; height:26px; border-radius:50%;
    background:linear-gradient(135deg, var(--brand-600), var(--brand-500));
    border:2px solid #fff; margin-top:-8px; box-shadow:0 6px 12px rgba(19,78,45,.25);
    transition: transform .08s ease;
  }
  input[type="range"]:active::-webkit-slider-thumb{ transform: scale(1.06) }

  .range-meta{ display:flex; align-items:center; justify-content:space-between; margin-top:6px; color:#64748b; font-size:.95rem }

  .switch{ display:flex; align-items:center; gap:10px; margin-top:12px }
  .switch input{ width:auto }
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    width:auto; min-width:160px; border:none; padding:14px 16px; margin-top:12px;
    border-radius:14px; font-weight:800; font-size:1.02rem; letter-spacing:.2px;
    cursor:pointer; color:#fff; background:linear-gradient(135deg, var(--brand-600), var(--brand-500));
    box-shadow: 0 12px 24px rgba(19,78,45,.25);
    transition: transform .06s ease, filter .2s ease, opacity .2s ease;
  }
  .btn.full{ width:100% }
  .btn:hover{ filter:brightness(1.03) }
  .btn:active{ transform: translateY(1px) }
  .btn.secondary{
    color:var(--ink);
    background:linear-gradient(135deg, #e7eef5, #dde7ee);
    box-shadow: 0 8px 18px rgba(2,8,23,.06);
  }

  .error{ color:var(--danger); font-weight:800; margin-top:10px; display:none }

  /* Amount chips */
  .chips{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px }
  .chip{
    -webkit-appearance:none; appearance:none;
    border:1px solid var(--outline); background:#fff; color:#0f172a;
    padding:10px 12px; border-radius:999px; font-weight:800; cursor:pointer; font-size:1rem;
  }
  .chip:focus{ outline:none; box-shadow:0 0 0 3px rgba(59,130,246,.18) }
  .input-inline{ display:flex; align-items:center; gap:12px; flex-wrap:wrap }
  .stepper{ display:inline-flex; align-items:center; border:1px solid var(--outline); border-radius:12px; overflow:hidden }
  .stepper button{ border:none; background:#f8fafc; padding:12px 14px; cursor:pointer; font-weight:800; font-size:1.1rem }
  .stepper input{ width:180px; border:none; text-align:right; padding:12px 14px; font-size:1.06rem }
  .stepper input:focus{ outline:none }

  /* Results */
  .side{ position:sticky; top:16px; height:fit-content }
  .heading{
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px;
    background:linear-gradient(135deg, #e7f5ec, #dff1e7);
    color:var(--brand-600); font-weight:800;
    border: 1px solid #cde8d7;
  }
  .kpis{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; margin-top:14px; }
  .kpi{
    background:linear-gradient(180deg, #ffffff, #f6fbff);
    border:1px solid var(--outline); border-radius:14px; padding:16px;
    box-shadow: var(--shadow-md);
  }
  .kpi .lbl{ font-size:.92rem; color:#64748b }
  .kpi .val{ font-size:1.35rem; font-weight:900; letter-spacing:.2px }
  .kpi .sub{ font-size:.85rem; color:#64748b }
  .subtle{ color:#64748b; font-weight:600; }

  .kpi1 { background:linear-gradient(180deg, #54b954a2, #5fd468);
    border:1px solid var(--outline); border-radius:14px; padding:16px;
    box-shadow: var(--shadow-md);}

  .progress{ margin:16px 0 6px; height:16px; background:#eef2f7; border-radius:999px; overflow:hidden; border:1px solid #e2e8f0 }
  .progress > div{
    height:100%; width:0%;
    background:linear-gradient(90deg, #22c55e, #16a34a);
    box-shadow: inset 0 0 10px rgba(255,255,255,.35);
    transition:width .45s cubic-bezier(.2,.7,.2,1), background .45s ease;
  }
  .progress-note{ font-size:.96rem; color:#64748b }

  .section-caption{ font-weight:900; color:#111827; margin:12px 0 8px }
  .note{ background:#fffdf7; border:1px dashed #f59e0b55; color:#7c4a03; padding:10px 12px; border-radius:12px }
  .callout{ border-left:6px solid var(--brand-600); background:#edf7f1; border:1px solid #cde8d7; padding:12px; border-radius:12px; }

  .rec{ border-radius:14px; padding:12px; border:1px solid var(--outline); margin-top:10px }
  .rec.ok{ background:#ecfdf5; border-color:#bbf7d0; color:#065f46 }
  .rec.warn{ background:#fff7ed; border-color:#fed7aa; color:#7c2d12 }
  .rec.bad{ background:#fef2f2; border-color:#fecaca; color:#7f1d1d }

  .charts{ display:grid; grid-template-columns: 1fr; gap:14px; margin-top:12px }
  .chart-card{ background:#fff; border:1px solid var(--outline); border-radius:14px; padding:12px; box-shadow:var(--shadow-md) }
  canvas{ max-width:100%; height:auto }

  /* Footer (unchanged except spacing) */
  .site-footer { background:#f8fafc; border-top:1px solid var(--outline); margin-top:40px }
  .footer-container {
    max-width:1260px; margin:0 auto; padding:32px 20px;
    display:grid; gap:28px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  }
  .footer-col h3 { font-size:16px; font-weight:800; margin-bottom:12px; color:var(--brand-600) }
  .footer-col p, .footer-col a { font-size:14px; color:#64748b; margin:6px 0; text-decoration:none }
  .footer-col a:hover { color:var(--accent-500) }
  .social-icons { margin-top:10px; display:flex; flex-wrap:wrap; gap:12px }
  .social-icons img { width:28px; height:28px; filter: grayscale(100%) opacity(.7); transition: filter .2s, transform .2s }
  .social-icons img:hover { filter:none; transform: scale(1.1) }
  .footer-bottom { border-top:1px solid var(--outline); background:#ffffff }
  .footer-bottom-inner {
    max-width:1260px; margin:0 auto; padding:14px 20px;
    display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center;
    font-size:13px; color:#64748b;
  }
  .footer-bottom .sep { opacity:.5 }
</style>
</head>
<body>
  <section class="hero">
    <div class="brand">
      <div class="brand-logo">JM</div>
      <div>
        <h1>JMVEST Finanzcheck</h1>
        <p>Motivier dich & plane realistisch â€“ klar, schnell und schÃ¶n.</p>
      </div>
    </div>
  </section>

  <!-- Tabs -->
  <nav class="tabs" role="tablist" aria-label="Investitionsmodus">
    <button id="tabDirect" class="tab" role="tab" aria-selected="true" aria-controls="panelDirect">ğŸ’¶ Direktbetrag</button>
    <button id="tabBudget" class="tab" role="tab" aria-selected="false" aria-controls="panelBudget">ğŸ§® Budget-Rechner (Alternative)</button>
  </nav>

  <div class="tabpanels">
    <!-- DIRECT (MAIN) -->
    <section id="panelDirect" class="tabpanel" aria-hidden="false" role="tabpanel" aria-labelledby="tabDirect">
      <div class="wrap">
        <div class="grid">
          <!-- LEFT: INPUT CARD -->
          <div class="card">
            <div class="pad">
              <div class="form-title">Direkter monatlicher Investitionsbetrag</div>
              <label for="directMonthly">Betrag pro Monat (â‚¬)</label>
              <div class="input-inline">
                <div class="stepper">
                  <button type="button" id="minusBtn">âˆ’</button>
                  <input type="number" id="directMonthly" min="0" step="10" inputmode="decimal" placeholder="z. B. 250">
                  <button type="button" id="plusBtn">+</button>
                </div>
                <button class="btn" id="applyDirect">Ãœbernehmen</button>
              </div>
              <div class="chips" aria-label="Schnellauswahl">
                <button class="chip" data-amt="50">50 â‚¬</button>
                <button class="chip" data-amt="100">100 â‚¬</button>
                <button class="chip" data-amt="250">250 â‚¬</button>
                <button class="chip" data-amt="500">500 â‚¬</button>
                <button class="chip" data-amt="1000">1.000 â‚¬</button>
              </div>
              <p class="hint">Tipp: Starte konservativ â€“ du kannst den Betrag jederzeit anpassen.</p>

              <div class="row">
                <div>
                  <label for="assets_direct">ğŸ’¼ Investierbares VermÃ¶gen (â‚¬)</label>
                  <div class="field"><input type="number" id="assets_direct" min="0" value="0" inputmode="decimal"></div>
                </div>
                <div>
                  <label for="duration_direct">â³ Zeithorizont (Jahre)</label>
                  <div class="field"><input type="range" id="duration_direct" min="1" max="30" step="1" value="15"></div>
                  <div class="range-meta"><span>1</span><strong><span id="durationVal_direct">15</span> Jahre</strong><span>30</span></div>
                </div>
              </div>

              <div class="divider"></div>

              <label for="goal_direct">ğŸ¯ Ziel</label>
              <div class="field">
                <select id="goal_direct">
                  <option value="Eigenheim" data-amount="300000">ğŸ¡ Eigenheim (300.000 â‚¬)</option>
                  <option value="FrÃ¼h in Rente" data-amount="500000">ğŸ–ï¸ FrÃ¼h in Rente (500.000 â‚¬)</option>
                  <option value="VermÃ¶gensaufbau" data-amount="200000" selected>ğŸ“ˆ VermÃ¶gensaufbau (200.000 â‚¬)</option>
                  <option value="Kinder Studium" data-amount="100000">ğŸ“ Studium der Kinder (100.000 â‚¬)</option>
                  <option value="Weltreise" data-amount="30000">ğŸŒ Weltreise (30.000 â‚¬)</option>
                  <option value="Finanzielle UnabhÃ¤ngigkeit" data-amount="1000000">ğŸ’¸ Finanzielle UnabhÃ¤ngigkeit (1.000.000 â‚¬)</option>
                  <option value="Eigenes Ziel">âœï¸ Eigenes Ziel â€¦</option>
                </select>
              </div>
              <div id="customGoalWrap_direct" style="display:none">
                <label for="customGoal_direct">Eigenes Ziel (â‚¬)</label>
                <div class="field"><input type="number" id="customGoal_direct" min="1" placeholder="z. B. 250.000"></div>
              </div>

              <div class="row">
                <div>
                  <label for="risk_direct">ğŸ“ˆ Risikoprofil</label>
                  <div class="field">
                    <select id="risk_direct">
                      <option value="0.025">ğŸ‚ Sehr gering (2,5% p.a.)</option>
                      <option value="0.055">ğŸ Sicherheitsorientiert (5,5% p.a.)</option>
                      <option value="0.065">ğŸ€ Defensiv  (6,5% p.a.)</option>
                      <option value="0.075">ğŸŒ± Ausgewogen  (7,5% p.a.)</option>
                      <option value="0.090">ğŸŒ³ Dynamisch (9% p.a.)</option>
                      <option value="0.095">ğŸŒ² Wachstum  (9,5% p.a.)</option>
                      <option value="0.125">ğŸŒ´ Stark Wachstum (12,5% p.a.)</option>
                      <option value="0.160">ğŸ”¥ Max. Wachstum (16% p.a.)</option>
                    </select>
                  </div>
                </div>
                <div>
                  <div class="switch"><input type="checkbox" id="inflation_direct"><label for="inflation_direct">ğŸ“‰ Inflation berÃ¼cksichtigen (2% p.a.)</label></div>
                  <div class="switch"><input type="checkbox" id="taxes_direct"><label for="taxes_direct">ğŸ’¶ Steuer berÃ¼cksichtigen (25% auf Gewinne)</label></div>
                </div>
              </div>

              <div class="row">
                <button type="button" id="submitDirect" class="btn full">ğŸš€ Check starten</button>
               
                <button type="button" id="resetDirect" class="btn secondary full">ZurÃ¼cksetzen</button>
              </div>
              <p class="hint" style="text-align:center;margin-top:8px">Die Werte bleiben nur in deinem Browser.</p>
            </div>
          </div>

          <!-- RIGHT: RESULT CARD (DIRECT) -->
          <div id="resultDirect" class="card side" aria-live="polite" aria-label="Ergebnis Direkt" data-visible="false">
            <div class="pad">
              <div class="heading">
                <h2 style="margin:0;font-size:1.2rem">Dein Ergebnis</h2>
                <div class="pill" id="badge_direct">Profil: â€“</div>
              </div>

              <div class="kpis" role="group" aria-label="Kennzahlen">
                <div class="kpi">
                  <div class="lbl">Monatlich investierbar</div>
                  <div class="val" id="kpiMonthly_direct">â€“</div>
                  <div class="sub" id="kpiMonthlyPct_direct"></div>
                </div>
                <div class="kpi">
                  <div class="lbl">Zielbetrag</div>
                  <div class="val" id="kpiGoal_direct">â€“</div>
                  <div class="sub" id="kpiGoalName_direct"></div>
                </div>
                <div class="kpi1">
                  <div class="lbl">EndvermÃ¶gen (Investieren)</div>
                  <div class="val" id="kpiFV_direct">â€“</div>
                  <div class="sub" id="kpiNote_direct"></div>
                </div>
                <div class="kpi">
                  <div class="lbl">Gap / Ãœberschuss</div>
                  <div class="val" id="kpiGap_direct">â€“</div>
                  <div class="sub" id="kpiGapHint_direct"></div>
                </div>
              </div>

              <div class="progress" aria-label="Ziel-Fortschritt">
                <div id="progressBar_direct"></div>
              </div>
              <div class="progress-note" id="progressNote_direct">Fortschritt: â€“</div>

              <div class="section-caption">Einordnung</div>
              <div class="callout" id="line3_direct"></div>
              <div class="note" id="line2_direct" style="margin-top:10px"></div>
              <div class="note" id="line1_direct" style="margin-top:10px"></div>

              <div id="recommendation_direct" class="rec" style="margin-top:12px"></div>
              <div id="debtTip_direct" class="rec warn" style="display:none; margin-top:10px"></div>
              <div id="emTip_direct" class="rec warn" style="display:none; margin-top:10px"></div>

              <div class="section-caption">Visualisierung</div>
              <div class="charts">
                <div class="chart-card"><canvas id="growthChart_direct" aria-label="VermÃ¶gensentwicklung" role="img"></canvas></div>
                <div class="chart-card"><canvas id="splitChart_direct" aria-label="Beitragsaufteilung" role="img"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BUDGET (ALTERNATIVE) -->
    <section id="panelBudget" class="tabpanel" aria-hidden="true" role="tabpanel" aria-labelledby="tabBudget">
      <main class="wrap">
        <div class="grid">
          <!-- LEFT: FORM -->
          <form id="financeForm" class="card" novalidate aria-describedby="formHelp">
            <div class="pad">
              <div class="form-title">Eingaben (Budget-Rechner)</div>

              <label for="income">ğŸ’° Monatliches Nettoeinkommen (â‚¬)</label>
              <div class="field"><input type="number" id="income" min="0" inputmode="decimal" placeholder="z. B. 2.800" required></div>
              <p class="hint">Netto pro Monat.</p>

              <label for="expenses">ğŸ  Monatliche Fixkosten (â‚¬)</label>
              <div class="field"><input type="number" id="expenses" min="0" inputmode="decimal" placeholder="z. B. 1.400" required></div>
              <p class="hint">Miete, Versicherungen, Abos, Ã–PNV â€¦</p>

              <div class="row">
                <div>
                  <label for="lifestyle">ğŸ§­ Lebensstil (% variabler Konsum)</label>
                  <div class="field"><input type="range" id="lifestyle" min="0" max="60" step="5" value="20"></div>
                  <div class="range-meta"><span>0%</span><strong><span id="lifestyleVal">20</span>%</strong><span>60%</span></div>
                </div>
                <div>
                  <label for="assets">ğŸ’¼ Investierbares VermÃ¶gen (â‚¬)</label>
                  <div class="field"><input type="number" id="assets" min="0" value="0" inputmode="decimal"></div>
                  <p class="hint">Depot / Tagesgeld.</p>
                </div>
              </div>

              <div class="divider"></div>

              <label for="goal">ğŸ¯ Ziel</label>
              <div class="field">
                <select id="goal" required>
                  <option value="Eigenheim" data-amount="300000">ğŸ¡ Eigenheim (300.000 â‚¬)</option>
                  <option value="FrÃ¼h in Rente" data-amount="500000">ğŸ–ï¸ FrÃ¼h in Rente (500.000 â‚¬)</option>
                  <option value="VermÃ¶gensaufbau" data-amount="200000" selected>ğŸ“ˆ VermÃ¶gensaufbau (200.000 â‚¬)</option>
                  <option value="Kinder Studium" data-amount="100000">ğŸ“ Studium der Kinder (100.000 â‚¬)</option>
                  <option value="Weltreise" data-amount="30000">ğŸŒ Weltreise (30.000 â‚¬)</option>
                  <option value="Finanzielle UnabhÃ¤ngigkeit" data-amount="1000000">ğŸ’¸ Finanzielle UnabhÃ¤ngigkeit (1.000.000 â‚¬)</option>
                  <option value="Eigenes Ziel">âœï¸ Eigenes Ziel â€¦</option>
                </select>
              </div>

              <div id="customGoalWrap" style="display:none">
                <label for="customGoal">Eigenes Ziel (â‚¬)</label>
                <div class="field"><input type="number" id="customGoal" min="1" placeholder="z. B. 250.000"></div>
              </div>

              <div class="row">
                <div>
                  <label for="risk">ğŸ“ˆ Risikoprofil</label>
                  <div class="field">
                    <select id="risk" required>
                      <option value="0.025">ğŸ‚ Sehr gering (2,5% p.a.)</option>
                      <option value="0.055">ğŸ Defensiv Klassisch (5,5% p.a.)</option>
                      <option value="0.065">ğŸ€ Defensiv Innovativ (6,5% p.a.)</option>
                      <option value="0.075">ğŸŒ± Ausgewogen Klassisch (7,5% p.a.)</option>
                      <option value="0.090">ğŸŒ³ Ausgewogen Innovativ (9% p.a.)</option>
                      <option value="0.095">ğŸŒ² Wachstum Klassisch (9,5% p.a.)</option>
                      <option value="0.125">ğŸŒ´ Wachstum Innovativ (12,5% p.a.)</option>
                      <option value="0.160">ğŸ”¥ Max. Wachstum (16% p.a.)</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label for="duration">â³ Zeithorizont (Jahre)</label>
                  <div class="field"><input type="range" id="duration" min="1" max="30" step="1" value="15"></div>
                  <div class="range-meta"><span>1</span><strong><span id="durationVal">15</span> Jahre</strong><span>30</span></div>
                </div>
              </div>

              <div class="row">
                <div class="switch">
                  <input type="checkbox" id="inflation">
                  <label for="inflation">ğŸ“‰ Inflation berÃ¼cksichtigen (2% p.a.)</label>
                </div>
                <div class="switch">
                  <input type="checkbox" id="taxes">
                  <label for="taxes">ğŸ’¶ Steuer berÃ¼cksichtigen (25% auf Gewinne)</label>
                </div>
              </div>

              <label for="debt">ğŸ“‰ Schulden</label>
              <div class="field">
                <select id="debt" required>
                  <option value="Keine">Keine</option>
                  <option value="Konsumschulden">Konsumschulden</option>
                  <option value="Studienkredite">Studienkredite</option>
                  <option value="Immobilienkredite">Immobilienschulden</option>
                </select>
              </div>

              <div class="row">
                <div>
                  <label for="emMonths">ğŸ›Ÿ Notgroschen (Monate)</label>
                  <div class="field"><input type="range" id="emMonths" min="0" max="12" step="1" value="3"></div>
                  <div class="range-meta"><span>0</span><strong><span id="emMonthsVal">3</span> Monate</strong><span>12</span></div>
                </div>
                <div>
                  <label for="liquid">ğŸ’§ Bereits vorhandene RÃ¼cklagen (â‚¬)</label>
                  <div class="field"><input type="number" id="liquid" min="0" value="0" inputmode="decimal"></div>
                </div>
              </div>

              <div class="row">
                <div class="btn full" role="button" tabindex="0" id="submitBudget">ğŸš€ Check starten</div>
                <button type="button" id="resetBtn" class="btn secondary full">ZurÃ¼cksetzen</button>
              </div>

              <p id="error" class="error" role="alert"></p>
              <p id="formHelp" class="hint" style="text-align:center;margin-top:12px">Deine Eingaben bleiben nur im Browser.</p>
            </div>
          </form>

          <!-- RIGHT: RESULT CARD (BUDGET) -->
          <div id="resultBudget" class="card side" aria-live="polite" aria-label="Ergebnis Budget" data-visible="false">
            <div class="pad">
              <div class="heading">
                <h2 style="margin:0;font-size:1.2rem">Dein Ergebnis</h2>
                <div class="pill" id="badge_budget">Profil: â€“</div>
              </div>

              <div class="kpis" role="group" aria-label="Kennzahlen">
                <div class="kpi">
                  <div class="lbl">Monatlich investierbar</div>
                  <div class="val" id="kpiMonthly_budget">â€“</div>
                  <div class="sub" id="kpiMonthlyPct_budget"></div>
                </div>
                <div class="kpi">
                  <div class="lbl">Zielbetrag</div>
                  <div class="val" id="kpiGoal_budget">â€“</div>
                  <div class="sub" id="kpiGoalName_budget"></div>
                </div>
                <div class="kpi1">
                  <div class="lbl">EndvermÃ¶gen (Investieren)</div>
                  <div class="val" id="kpiFV_budget">â€“</div>
                  <div class="sub" id="kpiNote_budget"></div>
                </div>
                <div class="kpi">
                  <div class="lbl">Gap / Ãœberschuss</div>
                  <div class="val" id="kpiGap_budget">â€“</div>
                  <div class="sub" id="kpiGapHint_budget"></div>
                </div>
              </div>

              <div class="progress" aria-label="Ziel-Fortschritt">
                <div id="progressBar_budget"></div>
              </div>
              <div class="progress-note" id="progressNote_budget">Fortschritt: â€“</div>

              <div class="section-caption">Einordnung</div>
              <div class="callout" id="line3_budget"></div>
              <div class="note" id="line2_budget" style="margin-top:10px"></div>
              <div class="note" id="line1_budget" style="margin-top:10px"></div>

              <div id="recommendation_budget" class="rec" style="margin-top:12px"></div>
              <div id="debtTip_budget" class="rec warn" style="display:none; margin-top:10px"></div>
              <div id="emTip_budget" class="rec warn" style="display:none; margin-top:10px"></div>

              <div class="section-caption">Visualisierung</div>
              <div class="charts">
                <div class="chart-card"><canvas id="growthChart_budget" aria-label="VermÃ¶gensentwicklung" role="img"></canvas></div>
                <div class="chart-card"><canvas id="splitChart_budget" aria-label="Beitragsaufteilung" role="img"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </section>
  </div>

  <footer class="site-footer" role="contentinfo">
    <div class="footer-container">
      <div class="footer-col">
        <h3>JMvest GbR</h3>
        <p>Building your wealth â€¢ Securing your future</p>
        <p><a href="#">Haftungsausschluss: Keine Anlageberatung</a></p>
      </div>
      <div class="footer-col">
        <h3>Rechtliches</h3>
        <p><a href="impressum.html">Impressum</a></p>
        <p><a href="agb.html">AGB</a></p>
      </div>
      <div class="footer-col">
        <h3>Kontakt</h3>
        <p><a href="mailto:jminvest@outlook.de">jminvest@outlook.de</a></p>
        <div class="social-icons">
          <a href="https://www.linkedin.com" target="_blank"><img src="iconslinkedin.png" alt="LinkedIn"></a>
          <a href="https://www.instagram.com" target="_blank"><img src="iconsinstagram.png" alt="Instagram"></a>
          <a href="https://twitter.com" target="_blank"><img src="iconstwitter.png" alt="Twitter"></a>
          <a href="https://www.youtube.com" target="_blank"><img src="iconsyoutube.png" alt="YouTube"></a>
          <a href="https://www.tiktok.com" target="_blank"><img src="iconstiktok.png" alt="TikTok"></a>
          <a href="https://www.facebook.com" target="_blank"><img src="iconsfacebook.png" alt="Facebook"></a>
          <a href="https://www.reddit.com" target="_blank"><img src="iconsreddit.png" alt="Reddit"></a>
          <a href="https://www.discord.com" target="_blank"><img src="iconsdiscord.png" alt="Discord"></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="footer-bottom-inner">
        JMvest GbR <span class="sep">â€¢</span> Transparent Â· Individuell Â· Reguliert
      </div>
    </div>
  </footer>

<script>window.addEventListener('load', function(){

// ===== Tabs logic =====
window.__jm_ready = false;
(function(){
  const $ = (s)=>document.querySelector(s);
  const tabDirect = $('#tabDirect'), tabBudget = $('#tabBudget');
  const panelDirect = $('#panelDirect'), panelBudget = $('#panelBudget');
  function select(which){
    const isDirect = which==='direct';
    tabDirect.setAttribute('aria-selected', String(isDirect));
    tabBudget.setAttribute('aria-selected', String(!isDirect));
    panelDirect.setAttribute('aria-hidden', String(!isDirect));
    panelBudget.setAttribute('aria-hidden', String(isDirect));
    localStorage.setItem('jm_mode', isDirect?'direct':'budget');
    window.__jm_isDirect = isDirect;
    // recalc nur wenn Setup fertig ist
    if (window.__jm_ready) calculate(false);
  }
  tabDirect.addEventListener('click', ()=>select('direct'));
  tabBudget.addEventListener('click', ()=>select('budget'));
  const saved = localStorage.getItem('jm_mode');
  if(saved==='budget'){ select('budget'); } else { select('direct'); }
})();

// ---------- Utilities ----------
const fmt0 = new Intl.NumberFormat('de-DE', { style:'currency', currency:'EUR', maximumFractionDigits: 0 });
const fmt2 = new Intl.NumberFormat('de-DE', { style:'currency', currency:'EUR', maximumFractionDigits: 2 });
const pct = (x) => new Intl.NumberFormat('de-DE', { style:'percent', maximumFractionDigits:1 }).format(x);

// Risk label
function riskLabel(r){
  const map = {
    0.025: "ğŸ‚ Sehr gering (2,5% p.a.)",
    0.055: "ğŸ Defensiv Klassisch (5,5% p.a.)",
    0.065: "ğŸ€ Defensiv Innovativ (6,5% p.a.)",
    0.075: "ğŸŒ± Ausgewogen Klassisch (7,5% p.a.)",
    0.09:  "ğŸŒ³ Ausgewogen Innovativ (9% p.a.)",
    0.095: "ğŸŒ² Wachstum Klassisch (9,5% p.a.)",
    0.125: "ğŸŒ´ Wachstum Innovativ (12,5% p.a.)",
    0.16:  "ğŸ”¥ Max. Wachstum (16% p.a.)"
  };
  return map[r] || (Math.round(r*1000)/10 + "% p.a.");
}

function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

// ===== DIRECT MODE elements =====
const e = (id) => document.getElementById(id);

const directMonthlyEl = e('directMonthly');
const minusBtn = document.getElementById('minusBtn');
const plusBtn = document.getElementById('plusBtn');
const chips = document.querySelectorAll('.chip');
const applyDirectBtn = document.getElementById('applyDirect');
const assetsDirectEl = e('assets_direct');
const durationDirectEl = e('duration_direct');
const durationValDirect = e('durationVal_direct');
const goalDirectEl = e('goal_direct');
const customGoalWrapDirect = e('customGoalWrap_direct');
const customGoalDirectEl = e('customGoal_direct');
const riskDirectEl = e('risk_direct');
const inflationDirectEl = e('inflation_direct');
const taxesDirectEl = e('taxes_direct');
const submitDirectBtn = e('submitDirect');
const resetDirectBtn = e('resetDirect');

// ===== BUDGET MODE elements =====
const form = document.getElementById('financeForm');
const incomeEl = e('income');
const expensesEl = e('expenses');
const lifestyleEl = e('lifestyle');
const lifestyleVal = e('lifestyleVal');
const assetsEl = e('assets');
const goalEl = e('goal');
const customGoalWrap = e('customGoalWrap');
const customGoalEl = e('customGoal');
const riskEl = e('risk');
const durationEl = e('duration');
const durationVal = e('durationVal');
const inflationEl = e('inflation');
const taxesEl = e('taxes');
const debtEl = e('debt');
const emMonthsEl = e('emMonths');
const emMonthsVal = e('emMonthsVal');
const liquidEl = e('liquid');
const resetBtn = e('resetBtn');
const err = document.getElementById('error');

// Chart instances per mode
const charts = {
  direct: { growth: null, split: null },
  budget: { growth: null, split: null }
};

// === Event wiring: DIRECT
goalDirectEl.addEventListener('change', ()=>{
  customGoalWrapDirect.style.display = goalDirectEl.value === 'Eigenes Ziel' ? 'block' : 'none';
  calculate(false);
});
durationDirectEl.addEventListener('input', ()=>{
  durationValDirect.textContent = durationDirectEl.value;
  calculate(false);
});
[directMonthlyEl, assetsDirectEl, riskDirectEl].forEach(el=>{
  el.addEventListener('input', ()=> calculate(false));
  el.addEventListener('change', ()=> calculate(false));
});
[inflationDirectEl, taxesDirectEl].forEach(el=> el.addEventListener('change', ()=> calculate(false)));
minusBtn.addEventListener('click', ()=>{ directMonthlyEl.value = String(Math.max(0, (parseFloat(directMonthlyEl.value)||0) - 10)); calculate(false); });
plusBtn.addEventListener('click', ()=>{ directMonthlyEl.value = String((parseFloat(directMonthlyEl.value)||0) + 10); calculate(false); });
chips.forEach(c=> c.addEventListener('click', ()=>{ directMonthlyEl.value = c.dataset.amt; calculate(false); }));
applyDirectBtn.addEventListener('click', ()=> calculate(true));
submitDirectBtn.addEventListener('click', ()=>{ calculate(true); });

resetDirectBtn.addEventListener('click', ()=>{
  directMonthlyEl.value = ''; assetsDirectEl.value = 0;
  durationDirectEl.value = 15; durationValDirect.textContent = '15';
  goalDirectEl.value = 'VermÃ¶gensaufbau'; customGoalWrapDirect.style.display = 'none';
  customGoalDirectEl.value = '';
  riskDirectEl.value = '0.075'; inflationDirectEl.checked = false; taxesDirectEl.checked = false;
  clearCharts('direct');
  resetResultUI('direct');
  localStorage.removeItem('jm_direct_monthly');
});

// === Event wiring: BUDGET
if(lifestyleEl) lifestyleEl.addEventListener('input', ()=>{ lifestyleVal.textContent = lifestyleEl.value; calculate(false); });
if(durationEl) durationEl.addEventListener('input', ()=>{ durationVal.textContent = durationEl.value; calculate(false); });
if(emMonthsEl) emMonthsEl.addEventListener('input', ()=>{ emMonthsVal.textContent = emMonthsEl.value; });

if(goalEl) goalEl.addEventListener('change', ()=>{
  customGoalWrap.style.display = goalEl.value === 'Eigenes Ziel' ? 'block' : 'none';
  calculate(false);
});

[ incomeEl, expensesEl, assetsEl, customGoalEl, riskEl, durationEl,
  lifestyleEl, inflationEl, taxesEl, debtEl, emMonthsEl, liquidEl
].forEach(el=>{ if(!el) return; el.addEventListener('input', ()=> calculate(false)); el.addEventListener('change', ()=> calculate(false)); });

const submitBudgetBtn = document.getElementById('submitBudget');
if(submitBudgetBtn){
  submitBudgetBtn.addEventListener('click', ()=>{ calculate(true); });
}
if(resetBtn){
  resetBtn.addEventListener('click', ()=>{
    if(form) form.reset();
    lifestyleEl.value = 20; lifestyleVal.textContent = '20';
    durationEl.value = 15; durationVal.textContent = '15';
    emMonthsEl.value = 3; emMonthsVal.textContent = '3';
    customGoalWrap.style.display = 'none';
    if(err){ err.style.display = 'none'; }
    clearCharts('budget');
    resetResultUI('budget');
  });
}

// Helpers to get suffix & elements for active mode
// ===== FINALIZE APP SETUP =====
try {
  window.__jm_ready = true;
  // einmal initial rechnen, basierend auf aktueller Tab-Wahl
  calculate(false);
} catch(e){ console.error(e); }

function idSfx(isDirect){ return isDirect ? '_direct' : '_budget'; }
function refs(isDirect){
  const sfx = idSfx(isDirect);
  return {
    container: document.getElementById(isDirect ? 'resultDirect' : 'resultBudget'),
    badge: e('badge' + sfx),
    kpiMonthly: e('kpiMonthly' + sfx),
    kpiMonthlyPct: e('kpiMonthlyPct' + sfx),
    kpiGoal: e('kpiGoal' + sfx),
    kpiGoalName: e('kpiGoalName' + sfx),
    kpiFV: e('kpiFV' + sfx),
    kpiNote: e('kpiNote' + sfx),
    kpiGap: e('kpiGap' + sfx),
    kpiGapHint: e('kpiGapHint' + sfx),
    progressBar: e('progressBar' + sfx),
    progressNote: e('progressNote' + sfx),
    line1: e('line1' + sfx),
    line2: e('line2' + sfx),
    line3: e('line3' + sfx),
    rec: e('recommendation' + sfx),
    debtTip: e('debtTip' + sfx),
    emTip: e('emTip' + sfx),
    growthCanvasId: 'growthChart' + sfx,
    splitCanvasId: 'splitChart' + sfx,
  };
}

function resetResultUI(mode){
  const isDirect = (mode === 'direct');
  const r = refs(isDirect);
  [r.kpiMonthly, r.kpiMonthlyPct, r.kpiGoal, r.kpiGoalName, r.kpiFV, r.kpiNote, r.progressNote, r.line1, r.line2, r.line3, r.kpiGap, r.kpiGapHint]
    .forEach(n=> { if(n) n.textContent = 'â€“'; });
  if(r.progressBar) r.progressBar.style.width = '0%';
  if(r.rec){ r.rec.textContent = ''; r.rec.className = 'rec'; }
  if(r.debtTip){ r.debtTip.style.display = 'none'; r.debtTip.textContent=''; }
  if(r.emTip){ r.emTip.style.display = 'none'; r.emTip.textContent=''; }
  if(r.container) r.container.dataset.visible = 'false';
}

// Core calc â€” works for both modes
function calculate(showErrors=false){
  const isDirect = (localStorage.getItem('jm_mode')!=='budget');
  const r = refs(isDirect);

  let monthlyAvailable = 0;
  let assets = 0;
  let years = 15;
  let annualReturn = 0.075;
  let inflation = 0;
  let taxes = false;
  let goalName, goalAmount;
  let debt = 'Keine', emMonths = 0, liquid = 0;

  if(isDirect){
    const m = parseFloat(directMonthlyEl.value);
    if((isNaN(m) || m < 0)){
      if(showErrors){ alert('Bitte gib einen gÃ¼ltigen Direktbetrag ein.'); }
      return;
    }
    monthlyAvailable = m;
    assets = parseFloat(assetsDirectEl.value||0);
    years = parseInt(durationDirectEl.value||0, 10);
    annualReturn = parseFloat(riskDirectEl.value||'0.075');
    inflation = inflationDirectEl.checked ? 0.02 : 0;
    taxes = taxesDirectEl.checked;
    goalName = goalDirectEl.value;
    if (goalName === 'Eigenes Ziel'){
      goalAmount = parseFloat(customGoalDirectEl.value||0);
      if(!goalAmount && showErrors){ alert('Bitte gib deinen individuellen Zielbetrag ein.'); return; }
    } else {
      goalAmount = parseFloat(goalDirectEl.selectedOptions[0].dataset.amount);
    }
  } else {
    const income = parseFloat(incomeEl.value);
    const expenses = parseFloat(expensesEl.value);
    const lifestylePct = parseFloat(lifestyleEl.value)/100;
    assets = parseFloat(assetsEl.value||0);
    annualReturn = parseFloat(riskEl.value||'0.075');
    years = parseInt(durationEl.value||0,10);
    inflation = inflationEl.checked ? 0.02 : 0;
    taxes = taxesEl.checked;
    debt = debtEl.value;
    emMonths = parseInt(emMonthsEl.value||0,10);
    liquid = parseFloat(liquidEl.value||0);

    if (isNaN(income) || income <= 0){
      if (showErrors && err){ err.textContent='Bitte gib ein gÃ¼ltiges monatliches Nettoeinkommen ein.'; err.style.display='block'; }
      return;
    }
    if (isNaN(expenses) || expenses < 0){
      if (showErrors && err){ err.textContent='Bitte gib gÃ¼ltige monatliche Fixkosten ein.'; err.style.display='block'; }
      return;
    }
    if (expenses > income){
      if (showErrors && err){ err.textContent='Fixkosten kÃ¶nnen nicht hÃ¶her als Einkommen sein.'; err.style.display='block'; }
      return;
    }
    goalName = goalEl.value;
    if (goalName === 'Eigenes Ziel'){
      goalAmount = parseFloat(customGoalEl.value||0);
      if (!goalAmount && showErrors){
        if(err){ err.textContent='Bitte gib deinen individuellen Zielbetrag ein.'; err.style.display='block'; }
        return;
      }
    } else {
      goalAmount = parseFloat(goalEl.selectedOptions[0].dataset.amount);
    }
    monthlyAvailable = income - expenses - (income * lifestylePct);
    if (monthlyAvailable < 0){
      if (showErrors && err){ err.textContent='Dein aktueller Lebensstil Ã¼berschreitet dein verfÃ¼gbares Einkommen.'; err.style.display='block'; }
      return;
    }
  }

  if (taxes){ annualReturn = annualReturn * (1 - 0.25); }
  const monthlyRate = annualReturn / 12;
  const months = years * 12;

  // Keep goal as nominal for display & charts
  const goalNominal = goalAmount;

  let fv_noSaving = assets * Math.pow(1 + monthlyRate, months);
  let fv_saveNoInterest = assets + monthlyAvailable * months;
  let fv_invest = assets;
  let fv_invest_nominal = assets;
  for (let i=0; i<months; i++){ fv_invest = (fv_invest + monthlyAvailable) * (1 + monthlyRate); fv_invest_nominal = (fv_invest_nominal + monthlyAvailable) * (1 + monthlyRate); }

  let fv_noSaving_display = fv_noSaving;
  let fv_saveNoInterest_display = fv_saveNoInterest;
  let fv_invest_display = fv_invest;
  let goalReal = goalNominal;
  if (inflation > 0){
    const infl = Math.pow(1 + inflation, years);
    fv_noSaving_display /= infl;
    fv_saveNoInterest_display /= infl;
    fv_invest_display /= infl;
    goalReal = goalNominal / infl;
  }
  // Basis fÃ¼r Fortschritt/GAP: real vs real (wenn Inflation aktiv), sonst nominal
  const goalBasis = (inflation>0 ? goalReal : goalNominal);

  // KPIs
  r.badge.textContent = 'Profil: ' + riskLabel(parseFloat(isDirect ? riskDirectEl.value : riskEl.value));
  r.kpiMonthly.textContent = fmt2.format(monthlyAvailable);
  r.kpiMonthlyPct.textContent = isDirect ? 'Direkt gewÃ¤hlt' : `= ${pct(monthlyAvailable/Math.max(1,(parseFloat(incomeEl?.value)||1)))} vom Einkommen`;
  r.kpiGoal.textContent = fmt2.format(goalNominal);
  r.kpiGoalName.innerHTML = inflation>0 ? `${goalName}<br><span class="subtle">Heutige Kaufkraft: ${fmt2.format(goalReal)}</span>` : goalName;
  r.kpiFV.textContent = fmt2.format(fv_invest_display);
  r.kpiNote.textContent = `${years} Jahre${inflation>0?' â€¢ inflationsbereinigt':''}${taxes?' â€¢ nach Steuern':''}`;

  // Lines
  r.line3.textContent = inflation>0 ? `Mit Investieren erreichst du voraussichtlich ${fmt2.format(fv_invest_display)} (heutige Kaufkraft).` : `Mit Investieren erreichst du voraussichtlich ${fmt2.format(fv_invest_display)}.`;
  r.line2.textContent = `Nur sparen (ohne Zinsen): ${fmt2.format(fv_saveNoInterest_display)} in ${years} Jahren.`;
  r.line1.textContent = `Ohne zusÃ¤tzliches Sparen (nur Zins auf vorhandenes VermÃ¶gen): ${fmt2.format(fv_noSaving_display)}.`;

  const progress = clamp((fv_invest_display / goalBasis) * 100, 0, 100);
  r.progressBar.style.width = progress.toFixed(1) + '%';
  // dynamic hue from red (0) -> yellow (50) -> green (100)
  const hue =  Math.round((progress/100)*120); // 0..120
  r.progressBar.style.background = `linear-gradient(90deg, hsl(${hue},70%,45%), hsl(${Math.min(120,hue+10)},70%,45%))`;
  r.progressNote.textContent = `Fortschritt: ${progress.toFixed(1)}% zum Ziel (${fmt2.format(goalBasis)} ${inflation>0?'in heutiger Kaufkraft':''}).`;

  const gap = fv_invest_display - goalBasis;
  r.kpiGap.textContent = fmt2.format(gap);
  r.kpiGapHint.textContent = gap >= 0 ? 'Ãœberschuss' : 'Fehlbetrag';

  r.rec.className = 'rec';
  if (gap >= 0){
    r.rec.classList.add('ok');
    r.rec.innerHTML = `ğŸ‰ Stark! Du erreichst dein Ziel. <strong>Ãœberschuss: ${fmt2.format(gap)}</strong>. Behalte deine Rate bei oder ziehe eine frÃ¼here Zielerreichung in Betracht.`;
  } else {
    const short = -gap;
    const neededMonthly = solveForMonthlyPayment(assets, monthlyRate, months, goalBasis);
    const delta = Math.max(0, neededMonthly - monthlyAvailable);
    let hint = '';
    if (delta > 1){
      hint = ` ErhÃ¶he die Sparrate um ca. <strong>${fmt2.format(delta)}</strong>.`;
    } else {
      const moreYears = years + 5;
      const fvExtend = futureValue(assets, monthlyAvailable, monthlyRate, moreYears*12);
      if (fvExtend >= goalBasis){
        hint = ` VerlÃ¤ngere den Zeitraum auf <strong>${moreYears} Jahre</strong>.`;
      } else {
        hint = ` Oder wÃ¤hle ein hÃ¶heres Renditeprofil (mit mehr Schwankungen).`;
      }
    }
    r.rec.classList.add(short > goalBasis*0.3 ? 'bad' : 'warn');
    r.rec.innerHTML = `âš ï¸ Dir fehlen ca. <strong>${fmt2.format(short)}</strong>.${hint}`;
  }

  // Budget-only tips
  if (!isDirect && debtEl){
    const income = parseFloat(incomeEl.value||0);
    const lifestylePct = parseFloat(lifestyleEl.value||0)/100;
    const totalMonthlyOut = (parseFloat(expensesEl.value||0)) + (income * lifestylePct);
    const emRequired = (parseInt(emMonthsEl.value||0,10)) * totalMonthlyOut;
    const emGap = emRequired - (parseFloat(liquidEl.value||0));
    const hasEmGap = emGap > 0.5;

    if (debtEl.value !== 'Keine'){
      r.debtTip.style.display = 'block';
      r.debtTip.innerHTML = debtTipText(debtEl.value);
    } else { r.debtTip.style.display = 'none'; r.debtTip.textContent = ''; }

    if (hasEmGap){
      r.emTip.style.display = 'block';
      r.emTip.innerHTML = `ğŸ’¡ Notgroschen-Empfehlung: ${emMonthsEl.value}Ã— Ausgaben â‰ˆ <strong>${fmt2.format(emRequired)}</strong>.
        Es fehlen ca. <strong>${fmt2.format(emGap)}</strong> an liquiden RÃ¼cklagen.`;
    } else { r.emTip.style.display = 'none'; r.emTip.textContent = ''; }
  } else {
    r.debtTip.style.display = 'none'; r.emTip.style.display = 'none';
  }

  drawCharts({
    mode: isDirect ? 'direct' : 'budget',
    months, monthlyAvailable, assets, monthlyRate,
    fv_noSaving: fv_noSaving_display,
    fv_saveNoInterest: fv_saveNoInterest_display,
    fv_invest_display: fv_invest_display,
    fv_invest_nominal: fv_invest_nominal,
    goalAmount: goalNominal
  });
  if(r.container) r.container.dataset.visible = 'true';

  if(isDirect){ localStorage.setItem('jm_direct_monthly', String(monthlyAvailable)); }
}

function debtTipText(type){
  switch(type){
    case 'Konsumschulden': return 'ğŸ’¡ Tipp: Tilge Konsumschulden zuerst â€“ Zinsen sind oft hÃ¶her als Anlagerenditen.';
    case 'Studienkredite': return 'ğŸ’¡ Tipp: Zahle planmÃ¤ÃŸig und prÃ¼fe Sondertilgungen (wenn zinsgÃ¼nstig).';
    case 'Immobilienkredite': return 'ğŸ’¡ Tipp: Solide Tilgung & RÃ¼cklagen fÃ¼r Instandhaltung einplanen.';
    default: return '';
  }
}

function solveForMonthlyPayment(PV, r, n, FV_target){
  if (r === 0){ const need = FV_target - PV; return need > 0 ? need / n : 0; }
  const a = Math.pow(1+r, n);
  return Math.max(0, (FV_target - PV*a) * (r / (a - 1)));
}
function futureValue(PV, PMT, r, n){
  if (r === 0) return PV + PMT*n;
  const a = Math.pow(1+r, n);
  return PV*a + PMT*((a-1)/r);
}

// Charts
function clearCharts(mode){
  const m = mode === 'direct' ? 'direct' : 'budget';
  if (charts[m].growth){ charts[m].growth.destroy(); charts[m].growth=null; }
  if (charts[m].split){ charts[m].split.destroy(); charts[m].split=null; }
}
function drawCharts(ctx){
  const { mode, months, monthlyAvailable, assets, monthlyRate, fv_noSaving, fv_saveNoInterest, fv_invest_display, fv_invest_nominal, goalAmount } = ctx;
  const labels = Array.from({length: months+1}, (_,i)=> i%12===0 ? (i/12).toString() : '');

  let s0=[assets], s1=[assets], s2=[assets];
  let v0=assets, v1=assets, v2=assets;
  for (let i=1; i<=months; i++){
    v0 = v0*(1+monthlyRate);
    v1 = v1 + monthlyAvailable;
    v2 = (v2 + monthlyAvailable)*(1+monthlyRate);
    s0.push(v0); s1.push(v1); s2.push(v2);
  }

  const growthCanvas = document.getElementById('growthChart_' + mode).getContext('2d');
  if (charts[mode].growth) charts[mode].growth.destroy();
  charts[mode].growth = new Chart(growthCanvas, {
    type:'line',
    data:{
      labels,
      datasets:[
        { label:'Ohne Sparen', data:s0, tension:.25 },
        { label:'Nur sparen (ohne Zins)', data:s1, tension:.25 },
        { label:'Investieren', data:s2, tension:.25, borderWidth:2 },
        { label:'Ziel', data:Array.from({length: months+1}, _=> goalAmount), borderDash:[6,6], tension:0 }
      ]
    },
    options:{
      responsive:true, maintainAspectRatio:false, aspectRatio:2,
      interaction:{ mode:'index', intersect:false },
      plugins:{
        legend:{ position:'top' },
        tooltip:{ callbacks:{ label:(c)=> `${c.dataset.label}: ${fmt2.format(c.parsed.y)}` } }
      },
      scales:{
        x:{ title:{ display:true, text:'Jahre' }, grid:{ display:false } },
        y:{ title:{ display:true, text:'VermÃ¶gen (â‚¬)' }, ticks:{ callback:(v)=> fmt0.format(v) } }
      }
    }
  });

  const contrib = assets + monthlyAvailable*months; // nominal Einzahlungen
  const gains = Math.max(0, fv_invest_nominal - contrib); // nominale ErtrÃ¤ge
  const splitCanvas = document.getElementById('splitChart_' + mode).getContext('2d');
  if (charts[mode].split) charts[mode].split.destroy();
  charts[mode].split = new Chart(splitCanvas, {
    type:'doughnut',
    data:{ labels:['Eigene Einzahlungen','ErtrÃ¤ge/Zinseszins'], datasets:[{ data:[Math.max(0,contrib), Math.max(0,gains)] }] },
    options:{
      responsive:true, maintainAspectRatio:false, aspectRatio:2,
      plugins:{
        legend:{ position:'top' },
        tooltip:{ callbacks:{ label:(c)=> `${c.label}: ${fmt2.format(c.parsed)}` } }
      },
      cutout:'58%'
    }
  });
}

// Init
setTimeout(()=>{
  const saved = Number(localStorage.getItem('jm_direct_monthly'))||0;
  if(saved>0) directMonthlyEl.value = String(saved);
  calculate(false);
}, 120);


});</script>
</body>
</html>
